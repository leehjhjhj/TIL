# 인덱스 구조 및 탐색

## 미리 보는 인덱스 튜닝

- DBMS가 발전해 왔지만 여전히 데이터를 찾는 방법은 두 가지이다.
    - 테이블 전체를 스캔한다.
    - 인덱스를 사용한다.

### 인덱스 튜닝의 두 가지 핵심요소

- 인덱스는 큰 테이블에서 소량의 데이터를 검색할 때 사용, 즉 `온라인 트랜잭션 처리` 에서 중요
- 인덱스 튜닝 핵심요소
    - 인덱스 스캔 효율화 튜닝
        - 시력이 1.0 ~ 1.5인 홍길동을 찾는 데에는 이름 순, 시력 순으로 정렬이 시력 순, 이름 순보다 더 좋다.
    - 랜덤 엑세스 최소화 튜닝
        - 이름만으로 정렬한 학생부 vs 시력 만으로 정렬된 학생부
    - 랜덤 엑세스 최소화 튜닝이 더 성능에 영향이 크다.
    - **SQL 튜닝은 랜덤 I/O와의 전쟁**이다.

## 인덱스 구조

- 인덱스를 사용하면 `범위 스캔`이 가능하다.
- DBMS는 일반적으로 `B Tree 인덱스`를 사용
- 루트, 브랜치, 리프가 존재
    - 루트와 브랜치 블록의 각 레코드는 하위 블록에 대한 주소값을 가진다.
    - LMC는 자식 노드 중 가장 왼쪽 끝에 위치한 블록을 가르킨다.
    - 리프 블록은 키값 순으로 정렬 + 테이블 레코드를 가르키는 주소 값인 ROWID를 갖는다.
    - ROWID 순으로 정렬된다
        - ROWID = 데이터 블록 주소 + 로우 번호
        - 데이터 블록주소 = 데이터 파일 번호 + 블록 번호
        - 블록 번호 = 데이터 파일 내에서 부여한 상대적 순번
        - 로우 번호: 블록 내 순번

### 인덱스 수직적 탐색

- 인덱스 스캔 시작지점을 찾는 과정
- 조건을 만족하는 첫 번재 레코드를 찾는 과정
    - 탐색 과정에서 **크거나 같은 값을 찾으면, 바로 직전 레코드가 가르키는 하위 블록으로 이동**
- 즉, 루트와 브랜치 블록은 등산의 이정표 역할을 한다.

### 인덱스 수평적 탐색

- 수직적 탐색으로 스캔 시작점을 찾고, 이제 리프 블록에서 수평적으로 스캔
- 리프는 양방향 연결 리스트 구조
- 조건절을 모두 찾기위해, 그리고 ROWID를 얻기 위해 수평적 탐색을 함

## 결합 인덱스 구조와 탐색

- 두 개 이상의 컬럼을 결합해서 인덱스를 만들 수도 있음
- delete를 해도 인덱스는 불균형 되지 않는다. `balanced` 이기 때문
- 루트부터 모든 리프 블록까지의 높이는 항상 같다.